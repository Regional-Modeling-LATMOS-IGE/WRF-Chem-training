# To watch
We recommend you watch this video before starting this exercise
**Running the WRF Model (for Real and Ideal Cases)**
> https://www.youtube.com/watch?v=yixvMF-g0nc

In this tutorial we will only work with Real cases.

# Exercise objective 
Setup of a regional model domain over Europe, run a real WRF case for the dates 1 - 7 January 2019.

<p align="center">
 <img width="460" src="First_run_domain.png">
</p>


# WRF initial and boundary conditions 
The WRF model requires initial and boundary conditions to start a simulation. These conditions provide the starting point for the model to simulate the evolution of the atmosphere over time. 

## Initial Conditions
Initial conditions describe the state of the atmosphere at the beginning of the simulation period. They include variables such as temperature, humidity, wind speed and direction, at various levels in the atmosphere. 

## Lateral Boundary Conditions
Boundary conditions specify how the atmosphere interacts with its surroundings at the edges of the simulation domain. They include information about the incoming flow of air, temperature, humidity, and other relevant variables at the boundaries of the model domain. Boundary conditions are often derived from global weather models or from observational data collected at locations surrounding the domain of interest.

## Lower Boundary Conditions
In order to run long simulations with changing surface properties (snow cover, sea ice, sea surface temperature, etc) we recommend you use the lower boundary condition option available in WRF.  
To adjust or "fix" the lower boundary conditions to be those read in from the analyses/reanalyses in WRF, you typically modify parameters related to land surface properties and processes. This can be done by using WRF lower boundary condition options in the WRF namelist (see below).

## Analyses for use 
In this tutorial we will use initial conditions from ERA5 
> https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-pressure-levels?tab=overview
> https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-single-levels?tab=overview

or from FNL
> https://rda.ucar.edu/datasets/ds083.2/


# Pre-defined model domain
We have pre defined a model domain for you, at 50km resolution, spanning most of Europe. You can find the corresponding `namelist.wps` on dahu here: 
> /bettik/PROJECTS/pr-regionalchem/laperer/WRF_training/Exercise-1/namelist.wps

If you wish to explore a different domain, you need to adjust the parameters (center latitude and longitude, number of grid cells, resolution...) in the `namelist.wps` file. But for the purpose of this training, we recommend keeping the proposed domain.

# WRF nudging options 


In this tutorial, the spectral nudging option is pre-set for you for the studied domain, but you should keep in mind that the associated options in the WRF parameter file `namelist.wrf` should be modified if you change the domain extent.

# Namelists
The main way you will set options and decide how you will use the WRF modeling system and preprocessing system is through namelists.


## What is the WPS namelist?
The `namelist.wps` file is a configuration file used by the WRF Preprocessing System (WPS) to set various parameters and options for preprocessing meteorological data before running the WRF model. the namelist.wps file is used as input for the three programs that make up the WPS
- `ungrib.exe`, `metgrid.exe`, and `geogrid.exe`

*namelist.wps* files include sections such as

- `&share` This section defines parameters related to file paths and other settings shared by multiple WPS programs.
- `&geogrid` Contains settings for the geogrid.exe program, which interpolates static geographical data to the model grid.
- `&ungrib` Defines options for the ungrib.exe program, which is used to decode and interpolate meteorological data from external sources (such as GRIB or NetCDF files) to the model grid.
- `&metgrid` Specifies settings for the metgrid.exe program, which interpolates meteorological fields generated by ungrib.exe to the model grid and generates input files for the WRF model.

  ```
  TO DO - put actual namelist here we plan to use for WPS in a code box
  ```

## What is the WRF namelist?
The `namelist.wrf` file is a configuration file used `wrf.exe`. The `namelist.wrf` file contains various parameters and settings that control how the model runs, including domain setup, physics options, boundary conditions, output settings, and many other aspects. It essentially serves as the main input file for configuring WRF simulations.  Example of WRF namelist sections include

- `&time_control` This section controls parameters related to time integration, such as the start and end times of the simulation, time step size, and output frequency.
- `&domains` Defines parameters related to the model domains, including horizontal grid spacing, vertical levels, domain nesting, and boundary conditions.
- `&physics` Specifies the physics parameterization schemes used in the model, such as microphysics, cumulus parameterization, planetary boundary layer, land surface model, and radiation schemes.
- `&fdda` Stands for Four-Dimensional Data Assimilation, this section configures the options related to the assimilation of observational data into the model.
- `&dynamics` Controls settings related to the numerical integration scheme, such as advection schemes and time integration methods.
- `&bdy_control` Specifies boundary condition options, including lateral boundary conditions and how they are updated.

 ```
  TO DO - put actual namelist here we plan to use for WRF in a code box
  ```

# Tutorial activities 

For this exercise, the WPS and WRF codes have already been compiled. To retrieve these working version of the code, copy these repositories in your home folder:
- WPS: `/bettik/PROJECTS/pr-regionalchem/laperer/WRF_training/src/WPS/`
- WRF: `/bettik/PROJECTS/pr-regionalchem/laperer/WRF_training/src/WRF/`

The parameter files, including the scripts to launch simulations, can be found there: */bettik/PROJECTS/pr-regionalchem/laperer/WRF_training/Exercise-1/*. Copy this repository on your home folder as well.

## Run WPS

In the *Exercise-1* folder, the file `jobscript_wps.sh` launches the preprocessing of initial and boundary condition data. If need be, adjust some of the paths in this script. Then use the command `oarsub -S ./jobscript_wps.sh`


## Run real



## Run WRF



## Plot WRF output

We have prepared python scripts that plot maps, time series of variables of interest for our simulation case. They can be found there: `/bettik/PROJECTS/pr-regionalchem/couetoup`
Feel free to copy them on your home folder and modify them as you wish.
