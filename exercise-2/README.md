# Exercise objective 
Setup of a regional model domain over Europe, run a real `WRF-Chem` case for the dates 1 - 7 January 2019.
For this exercise, all of exercise-1 applies, except we add the `Chem` component of the model. Hereafter are only mentioned the specifics of `Chem`. all information related to WRF is in the exercise-1 folder.

<p align="center">
 <img width="460" src="../exercise-1/First_run_domain.png">
</p>


# WRF-Chem preprocessors

## Initial and boundary conditions 
The WRF-Chem model requires initial and boundary conditions to start a simulation. These conditions provide the starting point for the model to simulate the evolution of the atmosphere over time. 

### Initial Conditions
Initial conditions describe the state of atmospheric composition at the beginning of the simulation period. They include concentrations of gases and aerosolss at various levels in the atmosphere. 

### Lateral Boundary Conditions
Boundary conditions specify how the atmosphere interacts with its surroundings at the edges of the simulation domain. They include information about the incoming flow of gases and aerosols at the boundaries of the model domain. Boundary conditions are often derived from global chemistry-transport models.

### Global runs used for boundary and initial conditions 
In this tutorial we will use initial and boundary conditions from CAM-CHEM 
> https://www.acom.ucar.edu/cesm/subset.shtml

For this exercise, we chose to use the MOZART+MOSAIC+AQCHEM chemistry option. Therefore, these initial and boundary conditions are prepared via the `mozbc` pre-processor.
The `mozbc_mozartmosaic.inp` parameter file provides a mapping between the species provided by CAM-CHEM onto the species defined in WRF-Chem for the chosen chemistry option.


## Anthropogenic emissions
Anthropogenic emissions are taken from the CAMS emissions inventory
> https://ads.atmosphere.copernicus.eu/cdsapp#!/dataset/cams-global-emission-inventories?tab=form

They are prepared with the `.py` script


## Fire emissions
Fire emissions are taken from the Fire INventory from NCAR (FINN), Version 1.5
> https://www.acom.ucar.edu/Data/fire/
They are prepared with the fire_emis pre-processor. The parameter file for the mapping depends on the chemistry option choice and is, in our case, `fire_emis_mozartmosaic.inp`.

## Biogenic emissions
Biogenic emissions are taken from the Model of Emissions of Gases and Aerosols from Nature (MEGAN).
> https://www2.acom.ucar.edu/modeling/model-emissions-gases-and-aerosols-nature-megan
These emissions are processed with the megan_bio_emiss preprocessor, using the parameter file `megan_bioemiss.inp`

# Namelists
The main way you will set options and decide how you will use the WRF modeling system and preprocessing system is through namelists.


## What is the WPS namelist?
The `namelist.wps` file is a configuration file used by the WRF Preprocessing System (WPS) to set various parameters and options for preprocessing meteorological data before running the WRF model. the namelist.wps file is used as input for the three programs that make up the WPS
- `ungrib.exe`, `metgrid.exe`, and `geogrid.exe`

*namelist.wps* files include sections such as

- `&share` This section defines parameters related to file paths and other settings shared by multiple WPS programs.
- `&geogrid` Contains settings for the geogrid.exe program, which interpolates static geographical data to the model grid.
- `&ungrib` Defines options for the ungrib.exe program, which is used to decode and interpolate meteorological data from external sources (such as GRIB or NetCDF files) to the model grid.
- `&metgrid` Specifies settings for the metgrid.exe program, which interpolates meteorological fields generated by ungrib.exe to the model grid and generates input files for the WRF model.

  ```
  TO DO - put actual namelist here we plan to use for WPS in a code box
  ```

## What is the WRF namelist?
The `namelist.wrf` file is a configuration file used `wrf.exe`. The `namelist.wrf` file contains various parameters and settings that control how the model runs, including domain setup, physics options, boundary conditions, output settings, and many other aspects. It essentially serves as the main input file for configuring WRF simulations.  Example of WRF namelist sections include

- `&time_control` This section controls parameters related to time integration, such as the start and end times of the simulation, time step size, and output frequency.
- `&domains` Defines parameters related to the model domains, including horizontal grid spacing, vertical levels, domain nesting, and boundary conditions.
- `&physics` Specifies the physics parameterization schemes used in the model, such as microphysics, cumulus parameterization, planetary boundary layer, land surface model, and radiation schemes.
- `&fdda` Stands for Four-Dimensional Data Assimilation, this section configures the options related to the assimilation of observational data into the model.
- `&dynamics` Controls settings related to the numerical integration scheme, such as advection schemes and time integration methods.
- `&bdy_control` Specifies boundary condition options, including lateral boundary conditions and how they are updated.

 ```
  TO DO - put actual namelist here we plan to use for WRF in a code box
  ```

# Tutorial activities 

For this exercise, the WPS and WRF codes have already been compiled. To retrieve these working version of the code, copy these repositories in your home folder:
- WPS: `/bettik/PROJECTS/pr-regionalchem/laperer/WRF_training/src/WPS/`
- WRF: `/bettik/PROJECTS/pr-regionalchem/laperer/WRF_training/src/WRF/`

The parameter files, including the scripts to launch simulations, can be found there: */bettik/PROJECTS/pr-regionalchem/laperer/WRF_training/Exercise-1/*. Copy this repository on your home folder as well.

## Run WPS

In the *Exercise-1* folder, the file `jobscript_wps.sh` launches the preprocessing of initial and boundary condition data. If need be, adjust some of the paths in this script. Then use the command `oarsub -S ./jobscript_wps.sh`


## Run real



## Run WRF



## Plot WRF output

We have prepared python scripts that plot maps, time series of variables of interest for our simulation case. They can be found there: `/bettik/PROJECTS/pr-regionalchem/couetoup`
Feel free to copy them on your home folder and modify them as you wish.

